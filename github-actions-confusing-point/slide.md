---
theme : "league"
transition: "slide"
slideNumber: false
customTheme : "my-style"
title: "GitHub Actions の使い方とハマリどころについて"
---

### GitHub Actions の使い方とハマリどころについて

<br>
<br>
<br>
<br>
kakisoft
<br>

&nbsp;&nbsp;<img src="../assets/kakisoft_logo.png" style="max-width: 10%;">


---

### GitHub Actions とは

GitHub 公式の CI/CD の仕組み。  

コードの変更やプッシュが行われたときに、特定のワークフローを自動的に実行できる。  

---

### 使い方


---

.github/workflows ディレクトリに、yamlファイルを配置。  

![x](../assets/001.png)

---

こんな感じでジョブが動く。  

![x](../assets/002.png)

---

### 基本構造

![x](../assets/003.png)

---

使うだけなら超簡単。  

しかし、やりたい事を実現させるには、結構変なハマり所もある。  

---

### 今回実現したい事

バックエンドのリポジトリとフロントエンドのリポジトリにて、Open API 仕様書の同期を取る。  
（backend で更新した内容が、自動的に frontend にも反映されるようにする）  

![x](../assets/004.png)

---

### 考えた方法

バックエンド側のリポジトリ push した時、差分をフロントエンド側にも反映。  

フロント側のリポジトリを clone し、バックエンド側で編集した内容を反映させ、pushする。  

---

### push 方法

GitHub Actions には、いくつかの命令が定義されているが、pushコマンドは無いので、コマンドにて実行。  
（この部分の詳細は割愛します）  

![x](../assets/005.png)


---

バックエンド側のリポジトリの内容が、フロント側に反映されたことを確認。  

---

しかし、変更が無かった場合、エラーが発生する。  

---

コミットする内容が無かった場合、exit code 1 を出力し、エラーで終了する。  

![x](../assets/006.png)


---

### 必要な処理

 * 変更があれば push
 * 変更が無ければ、pushしない

「変更があるかどうか」を判定し、処理を分岐をする。

---

### ポイント１．条件判定

---

変更前の内容と変更後の内容で diff を取る。  

![x](../assets/007.png)

---

diff 判定した時点で、exit code 1 で終了。（エラーで終了する）  
※差分が無かった場合は、エラーが発生しない。  

![x](../assets/008.png)

---

「> /dev/null」がマズいのか？　と思い、変数化してみるが、これでもエラー。  

![x](../assets/009.png)

---

### 回避方法

判定条件は if 文の中に入れる。  

![x](../assets/010.png)


---

途中で exit code が出ないように気を遣う必要がある模様。  

![x](../assets/011.png)

---

### ポイント２．分岐処理

---

#### 実現したい事
 * 変更があれば push
 * 変更が無ければ、pushしない

↓
＜実装内容＞  
変更が無ければ、それ以降のジョブを実行しない

---

### _


---

### _


---

### _


---

### _


---

### _


---

### _


---

おわり